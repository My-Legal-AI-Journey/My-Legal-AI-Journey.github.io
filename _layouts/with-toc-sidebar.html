<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      .page-wrapper {
        display: flex;
        max-width: 1400px;
        margin: 0 auto;
        gap: 40px;
        padding: 20px;
      }
      
      .sidebar {
        width: 320px;
        flex-shrink: 0;
        background: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        position: sticky;
        top: 20px;
        max-height: calc(100vh - 40px);
        overflow-y: auto;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      
      .main-content {
        flex: 1;
        min-width: 0;
        background: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      
      /* ä¾§è¾¹æ å¯¼èˆªæ ·å¼ */
      .sidebar h3 {
        margin-top: 0;
        color: #24292e;
        border-bottom: 2px solid #0366d6;
        padding-bottom: 10px;
        font-size: 18px;
      }
      
      .sidebar-nav {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      
      .sidebar-nav li {
        margin-bottom: 6px;
      }
      
      .sidebar-nav a {
        display: flex;
        align-items: center;
        padding: 8px 12px;
        color: #586069;
        text-decoration: none;
        border-radius: 4px;
        transition: all 0.2s ease;
        font-size: 14px;
        line-height: 1.4;
      }
      
      .sidebar-nav a:hover {
        background: #0366d6;
        color: white;
      }
      
      .sidebar-nav .active {
        background: #0366d6;
        color: white;
        font-weight: 500;
      }
      
      .nav-section {
        margin-bottom: 15px;
      }
      
      .nav-section-title {
        font-weight: 600;
        color: #24292e;
        font-size: 14px;
        margin: 20px 0 12px 0;
        padding-left: 8px;
        border-left: 3px solid #0366d6;
      }
      
      .nav-subitem {
        padding-left: 28px !important;
        font-size: 13px !important;
      }
      
      .nav-subsubitem {
        padding-left: 44px !important;
        font-size: 12px !important;
        color: #6a737d !important;
      }
      
      /* å¯æŠ˜å ç®­å¤´ */
      .toggle-arrow {
        margin-right: 8px;
        transition: transform 0.2s ease;
        font-size: 12px;
        width: 16px;
        text-align: center;
      }
      
      .collapsed .toggle-arrow {
        transform: rotate(-90deg);
      }
      
      .collapsible-section {
        transition: all 0.3s ease;
      }
      
      .collapsed + .section-content {
        display: none;
      }
      
      .section-content {
        margin-left: 16px;
      }
      
      /* é¡µé¢å†…æ ‡é¢˜æ ·å¼ */
      .main-content h1 {
        border-bottom: 2px solid #eaecef;
        padding-bottom: 10px;
        margin-top: 0;
      }
      
      .main-content h2 {
        border-left: 4px solid #0366d6;
        padding-left: 12px;
        margin-top: 30px;
      }
      
      .main-content h3 {
        border-left: 2px solid #28a745;
        padding-left: 12px;
        margin-top: 20px;
      }
      
      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 1024px) {
        .page-wrapper {
          flex-direction: column;
        }
        .sidebar {
          width: 100%;
          position: static;
          order: 2;
        }
        .main-content {
          order: 1;
        }
      }
    </style>
    {% seo %}
  </head>
  <body>
    <div class="page-wrapper">
      <!-- æ™ºèƒ½ä¾§è¾¹æ  -->
      <nav class="sidebar" id="toc-sidebar">
        <h3>ğŸ“š å¯¼èˆªç›®å½•</h3>
        
        <!-- è¿”å›æŒ‰é’® -->
        <div class="nav-section">
          <ul class="sidebar-nav">
            <li><a href="/" class="back-home">â† è¿”å›é¦–é¡µ</a></li>
            <li><a href="/legal-notes/" class="{% if page.url contains '/legal-notes' %}active{% endif %}">ğŸ“– æ³•å­¦ç¬”è®°ä¸»é¡µ</a></li>
          </ul>
        </div>
        
        <!-- é¡µé¢æ ‡é¢˜ç´¢å¼• -->
        <div class="nav-section">
          <div class="nav-section-title">ğŸ“„ æœ¬é¡µç›®å½•</div>
          <div id="page-toc"></div>
        </div>
        
        <!-- ç½‘ç«™å¯¼èˆª -->
        <div class="nav-section">
          <div class="nav-section-title">ğŸŒ ç½‘ç«™å¯¼èˆª</div>
          <ul class="sidebar-nav" id="site-navigation">
            <!-- æ°‘æ³•ç¬”è®°éƒ¨åˆ† -->
            <li>
              <a href="javascript:void(0)" class="collapsible-section" data-section="civil-law">
                <span class="toggle-arrow">â–¼</span>âš–ï¸ æ°‘æ³•ç¬”è®°
              </a>
              <ul class="section-content" id="civil-law-section">
                <li><a href="/civil-law/">æ°‘æ³•æ€»è§ˆ</a></li>
                <li><a href="/civil-law/general-theory/" class="nav-subitem">æ°‘æ³•æ€»è®º</a></li>
                <li><a href="/civil-law/obligation-contract/" class="nav-subitem">å€ºä¸åˆåŒæ³•</a></li>
                <li><a href="/civil-law/property-law/" class="nav-subitem">ç‰©æƒæ³•</a></li>
                <li><a href="/civil-law/family-inheritance/" class="nav-subitem">å©šå§»å®¶åº­ä¸ç»§æ‰¿æ³•</a></li>
                <li><a href="/civil-law/personality-rights/" class="nav-subitem">äººæ ¼æƒæ³•</a></li>
                <li><a href="/civil-law/tort-law/" class="nav-subitem">ä¾µæƒæ³•</a></li>
              </ul>
            </li>
            
            <!-- çŸ¥è¯†äº§æƒæ³•éƒ¨åˆ† -->
            <li>
              <a href="javascript:void(0)" class="collapsible-section" data-section="ip-law">
                <span class="toggle-arrow">â–¼</span>ğŸ’¡ çŸ¥è¯†äº§æƒæ³•
              </a>
              <ul class="section-content" id="ip-law-section">
                <li><a href="/intellectual-property/">çŸ¥è¯†äº§æƒæ€»è§ˆ</a></li>
                <li><a href="/intellectual-property/copyright/" class="nav-subitem">è‘—ä½œæƒæ³•</a></li>
                <li><a href="/intellectual-property/patent/" class="nav-subitem">ä¸“åˆ©æ³•</a></li>
                <li><a href="/intellectual-property/trademark/" class="nav-subitem">å•†æ ‡æ³•</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </nav>
      
      <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
      <main class="main-content">
        {{ content }}
      </main>
    </div>

    <script>
      // æŠ˜å /å±•å¼€åŠŸèƒ½
      document.addEventListener('DOMContentLoaded', function() {
        // ç½‘ç«™å¯¼èˆªæŠ˜å åŠŸèƒ½
        const collapsibleSections = document.querySelectorAll('.collapsible-section');
        collapsibleSections.forEach(section => {
          section.addEventListener('click', function() {
            this.classList.toggle('collapsed');
            const arrow = this.querySelector('.toggle-arrow');
            if (this.classList.contains('collapsed')) {
              arrow.textContent = 'â–¶';
            } else {
              arrow.textContent = 'â–¼';
            }
          });
        });
        
        // ç”Ÿæˆé¡µé¢æ ‡é¢˜ç›®å½•
        generatePageTOC();
        
        // å¹³æ»‘æ»šåŠ¨åˆ°é”šç‚¹
        setupSmoothScrolling();
      });
      
      // ç”Ÿæˆé¡µé¢æ ‡é¢˜ç›®å½•
      function generatePageTOC() {
        const mainContent = document.querySelector('.main-content');
        const headings = mainContent.querySelectorAll('h1, h2, h3, h4');
        const tocContainer = document.getElementById('page-toc');
        
        if (headings.length <= 1) {
          tocContainer.innerHTML = '<p style="color: #6a737d; font-size: 13px; padding: 0 12px;">æœ¬é¡µæš‚æ— æ ‡é¢˜ç»“æ„</p>';
          return;
        }
        
        let tocHTML = '<ul class="sidebar-nav">';
        let currentLevel = 1;
        
        headings.forEach((heading, index) => {
          if (heading.tagName === 'H1' && index === 0) return; // è·³è¿‡é¡µé¢ä¸»æ ‡é¢˜
          
          const level = parseInt(heading.tagName.substring(1));
          const id = heading.id || `heading-${index}`;
          heading.id = id;
          
          const text = heading.textContent;
          const indentClass = getIndentClass(level);
          
          tocHTML += `
            <li>
              <a href="#${id}" class="toc-link ${indentClass}" data-level="${level}">
                ${getToggleArrow(level)}
                ${text}
              </a>
            </li>
          `;
        });
        
        tocHTML += '</ul>';
        tocContainer.innerHTML = tocHTML;
        
        // ä¸ºTOCæ·»åŠ æŠ˜å åŠŸèƒ½
        setupTOCCollapsible();
      }
      
      // è·å–ç¼©è¿›ç±»å
      function getIndentClass(level) {
        switch(level) {
          case 1: return '';
          case 2: return 'nav-subitem';
          case 3: return 'nav-subsubitem';
          default: return 'nav-subsubitem';
        }
      }
      
      // è·å–åˆ‡æ¢ç®­å¤´ï¼ˆä»…å¯¹å¯æŠ˜å çš„çº§åˆ«æ˜¾ç¤ºï¼‰
      function getToggleArrow(level) {
        if (level <= 2) {
          return '<span class="toggle-arrow">â–¼</span>';
        }
        return '<span style="width: 16px; display: inline-block;"></span>';
      }
      
      // è®¾ç½®TOCæŠ˜å åŠŸèƒ½
      function setupTOCCollapsible() {
        const tocLinks = document.querySelectorAll('.toc-link[data-level="1"], .toc-link[data-level="2"]');
        
        tocLinks.forEach(link => {
          if (link.querySelector('.toggle-arrow')) {
            link.style.cursor = 'pointer';
            link.addEventListener('click', function(e) {
              const level = parseInt(this.getAttribute('data-level'));
              const nextItems = getNextTOCItems(this);
              
              if (nextItems.length > 0) {
                e.preventDefault();
                this.classList.toggle('collapsed');
                const arrow = this.querySelector('.toggle-arrow');
                
                if (this.classList.contains('collapsed')) {
                  arrow.textContent = 'â–¶';
                  nextItems.forEach(item => item.style.display = 'none');
                } else {
                  arrow.textContent = 'â–¼';
                  nextItems.forEach(item => item.style.display = '');
                }
              } else {
                // å¦‚æœæ²¡æœ‰å­é¡¹ï¼Œç›´æ¥è·³è½¬
                const targetId = this.getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                  targetElement.scrollIntoView({ behavior: 'smooth' });
                }
              }
            });
          } else {
            // ç›´æ¥è·³è½¬
            link.addEventListener('click', function(e) {
              e.preventDefault();
              const targetId = this.getAttribute('href').substring(1);
              const targetElement = document.getElementById(targetId);
              if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth' });
              }
            });
          }
        });
      }
      
      // è·å–TOCä¸­ä¸‹ä¸€ä¸ªé¡¹ç›®
      function getNextTOCItems(currentLink) {
        const items = [];
        let nextElement = currentLink.parentElement.nextElementSibling;
        
        while (nextElement) {
          const link = nextElement.querySelector('.toc-link');
          if (link) {
            const nextLevel = parseInt(link.getAttribute('data-level'));
            const currentLevel = parseInt(currentLink.getAttribute('data-level'));
            
            if (nextLevel > currentLevel) {
              items.push(nextElement);
              nextElement = nextElement.nextElementSibling;
            } else {
              break;
            }
          } else {
            break;
          }
        }
        
        return items;
      }
      
      // è®¾ç½®å¹³æ»‘æ»šåŠ¨
      function setupSmoothScrolling() {
        const links = document.querySelectorAll('a[href^="#"]');
        links.forEach(link => {
          link.addEventListener('click', function(e) {
            const href = this.getAttribute('href');
            if (href !== '#') {
              e.preventDefault();
              const targetElement = document.querySelector(href);
              if (targetElement) {
                targetElement.scrollIntoView({ 
                  behavior: 'smooth',
                  block: 'start'
                });
              }
            }
          });
        });
      }
    </script>
  </body>
</html>
